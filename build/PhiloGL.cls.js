/*

 Copyright (c) 2011 Sencha Labs - Author: Nicolas Garcia Belmonte (http://philogb.github.com/)

 Permission is hereby granted, free of charge, to any person obtaining a copy
 of this software and associated documentation files (the "Software"), to deal
 in the Software without restriction, including without limitation the rights
 to use, copy, modify, merge, publish, distribute, sublicense, and/or sell
 copies of the Software, and to permit persons to whom the Software is
 furnished to do so, subject to the following conditions:

 The above copyright notice and this permission notice shall be included in
 all copies or substantial portions of the Software.

 THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR
 IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,
 FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE
 AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER
 LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,
 OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN
 THE SOFTWARE.

*/
(function(){function t(x){return document.getElementById(x)}this.PhiloGL=null;(function(){PhiloGL=function(x,y){function r(s,A,u){var z=s.canvas,a=new PhiloGL.Camera(d.fov,z.width/z.height,d.near,d.far,d);a.update();var b=new PhiloGL.Scene(A,a,c);M=new PhiloGL.WebGL.Application({gl:s,canvas:z,program:A,scene:b,camera:a});A.$$family=="program"&&A.use();f&&PhiloGL.Events.create(M,t.extend(f,{bind:M}));if(h.src.length)new PhiloGL.IO.Textures(t.extend(h,{onComplete:function(){u(M)}}));else u(M)}y=t.merge({context:{},
<<<<<<< HEAD
camera:{fov:45,near:0.1,far:500},program:{from:"defaults",vs:"Default",fs:"Default"},scene:{},textures:{src:[]},events:{},onLoad:t.empty,onError:t.empty},y||{});var m=y.context,d=y.camera,f=y.events,h=y.textures,k=t.splat(y.program),c=y.scene;o=PhiloGL.WebGL.getContext(x,m);if(!o){y.onError("The WebGL context couldn't been initialized");return null}var l={defaults:"fromDefaultShaders",ids:"fromShaderIds",sources:"fromShaderSources",uris:"fromShaderURIs"},i=k.length,n=function(){var s=i,A={},u=false;
return{onSuccess:function(z,a){A[a.id||i-s]=z;s--;if(s===0&&!u)r(o,i==1?z:A,function(b){y.onLoad(b)})},onError:function(z){s--;y.onError(z);u=true}}}();k.forEach(function(s){var A=s.from,u,z;for(z in l)if(A==z){try{u=PhiloGL.Program[l[z]](t.extend(n,s))}catch(a){n.onError(a)}break}if(u)n.onSuccess(u,s)})}})();PhiloGL.unpack=function(x){x=x||aa;["Vec3","Mat4","Quat","Camera","Program","WebGL","O3D","Scene","Shaders","IO","Events","WorkerGroup","Fx","Media"].forEach(function(y){x[y]=PhiloGL[y]})};PhiloGL.version=
"1.4.2";var o,M,aa=this;t.empty=function(){};t.time=Date.now;t.uid=function(){var x=t.time();return function(){return x++}}();t.extend=function(x,y){for(var r in y)x[r]=y[r];return x};t.type=function(){var x=Object.prototype.toString;return function(y){var r;r=x.call(y);r=r.substr(8,r.length-9).toLowerCase();if(r!="object")return r;if(y.$$family)return y.$$family;return y&&y.nodeName&&y.nodeType==1?"element":r}}();(function(){function x(y){var r=t.type(y);if(r=="object"){r={};for(var m in y)r[m]=
x(y[m]);return r}else if(r=="array"){r=[];m=0;for(var d=y.length;m<d;m++)r[m]=x(y[m]);return r}else return y}t.merge=function(){for(var y={},r=0,m=arguments.length;r<m;r++){var d=arguments[r];if(t.type(d)=="object")for(var f in d){var h=d[f],k=y[f];y[f]=k&&t.type(h)=="object"&&t.type(k)=="object"?t.merge(k,h):x(h)}}return y}})();t.splat=function(){var x=Array.isArray;return function(y){return x(y)&&y||[y]}}();(function(){function x(r){for(var m in r)this[m]=r[m];this.buffers={};this.bufferMemo={};
this.frameBuffers={};this.frameBufferMemo={};this.renderBuffers={};this.renderBufferMemo={};this.textures={};this.textureMemo={}}var y={getContext:function(r,m){r=typeof r=="string"?t(r):r;var d;(d=r.getContext("experimental-webgl",m))||(d=r.getContext("webgl",m));if(d&&m&&m.debug){o={};for(var f in d){var h=d[f];o[f]=typeof h=="function"?function(k,c){return function(){console.log(k,Array.prototype.join.call(arguments),Array.prototype.slice.call(arguments));try{var l=c.apply(d,arguments)}catch(i){throw k+
" "+i;}for(var n=[],s;(s=d.getError())!==d.NO_ERROR;)n.push(s);if(n.length)throw n.join();return l}}(f,h):h}}else o=d;if(o)o.get=function(k){return typeof k=="string"?o[k]:k};return o}};x.prototype={$$family:"application",setBuffer:function(r,m,d){if(d===false||d===null){(d=this.bufferMemo[m])&&o.bindBuffer(d.bufferType,null);var f=d&&d.attribute||m;r=r.attributes[f];r!==undefined&&o.disableVertexAttribArray(r)}else{d=t.extend(this.bufferMemo[m]||{bufferType:o.ARRAY_BUFFER,size:1,dataType:o.FLOAT,
stride:0,offset:0,drawType:o.STATIC_DRAW},d||{});f=d.attribute||m;var h=d.bufferType,k=m in this.buffers,c=k?this.buffers[m]:o.createBuffer(),l="value"in d,i=d.value,n=d.size,s=d.dataType,A=d.stride,u=d.offset,z=d.drawType;r=r.attributes[f];var a=r!==undefined;k||(this.buffers[m]=c);a&&o.enableVertexAttribArray(r);o.bindBuffer(h,c);l&&o.bufferData(h,i,z);a&&o.vertexAttribPointer(r,n,s,false,A,u);delete d.value;this.bufferMemo[m]=d;if(a)this.bufferMemo[f]=d;return this}},setBuffers:function(r,m){for(var d in m)this.setBuffer(r,
d,m[d]);return this},setFrameBuffer:function(r,m){if(typeof m!="object")o.bindFramebuffer(o.FRAMEBUFFER,m?this.frameBuffers[r]:null);else{m=t.merge(this.frameBufferMemo[r]||{width:0,height:0,bindToTexture:false,textureOptions:{attachment:o.COLOR_ATTACHMENT0},bindToRenderBuffer:false,renderBufferOptions:{attachment:o.DEPTH_ATTACHMENT}},m||{});var d=m.bindToTexture,f=m.bindToRenderBuffer,h=r in this.frameBuffers,k=h?this.frameBuffers[r]:o.createFramebuffer(o.FRAMEBUFFER);o.bindFramebuffer(o.FRAMEBUFFER,
k);h||(this.frameBuffers[r]=k);if(d){d=t.merge({data:{width:m.width,height:m.height}},t.type(d)=="object"?d:{});h=r+"-texture";k=m.textureOptions;this.setTexture(h,d);o.framebufferTexture2D(o.FRAMEBUFFER,k.attachment,this.textureMemo[h].textureType,this.textures[h],0)}if(f){f=t.extend({width:m.width,height:m.height},t.type(f)=="object"?f:{});d=r+"-renderbuffer";h=m.renderBufferOptions;this.setRenderBuffer(d,f);o.framebufferRenderbuffer(o.FRAMEBUFFER,h.attachment,o.RENDERBUFFER,this.renderBuffers[d])}o.bindTexture(o.TEXTURE_2D,
null);o.bindRenderbuffer(o.RENDERBUFFER,null);o.bindFramebuffer(o.FRAMEBUFFER,null);this.frameBufferMemo[r]=m;return this}},setFrameBuffers:function(r){for(var m in r)this.setFrameBuffer(m,r[m]);return this},setRenderBuffer:function(r,m){if(typeof m!="object")o.bindRenderbuffer(o.RENDERBUFFER,m?this.renderBufferMemo[r]:null);else{m=t.extend(this.renderBufferMemo[r]||{storageType:o.DEPTH_COMPONENT16,width:0,height:0},m||{});var d=r in this.renderBuffers,f=d?this.renderBuffers[r]:o.createRenderbuffer(o.RENDERBUFFER);
d||(this.renderBuffers[r]=f);o.bindRenderbuffer(o.RENDERBUFFER,f);o.renderbufferStorage(o.RENDERBUFFER,m.storageType,m.width,m.height);this.renderBufferMemo[r]=m;return this}},setRenderBuffers:function(r){for(var m in r)this.setRenderBuffer(m,r[m]);return this},setTexture:function(r,m){if(!m||typeof m!="object"){o.activeTexture(m||o.TEXTURE0);o.bindTexture(this.textureMemo[r].textureType||o.TEXTURE_2D,this.textures[r])}else{m=t.merge(this.textureMemo[r]||{textureType:o.TEXTURE_2D,pixelStore:[{name:o.UNPACK_FLIP_Y_WEBGL,
value:true},{name:o.UNPACK_ALIGNMENT,value:1}],parameters:[{name:o.TEXTURE_MAG_FILTER,value:o.NEAREST},{name:o.TEXTURE_MIN_FILTER,value:o.NEAREST}],data:{format:o.RGBA,value:false,width:0,height:0,border:0}},m||{});var d="textureType"in m?o.get(m.textureType):o.TEXTURE_2D,f="textureTarget"in m?o.get(m.textureTarget):d,h=d==o.TEXTURE_CUBE_MAP,k=r in this.textures,c=k?this.textures[r]:o.createTexture(),l=m.pixelStore,i=m.parameters,n=m.data,s=n.value,A=n.format,u=!!n.value;k||(this.textures[r]=c);o.bindTexture(d,
c);k||l.forEach(function(z){z.name=typeof z.name=="string"?o[z.name]:z.name;o.pixelStorei(z.name,z.value)});if(u)if(h)for(c=0;c<6;++c)o.texImage2D(f[c],0,A,A,o.UNSIGNED_BYTE,s[c]);else o.texImage2D(f,0,A,A,o.UNSIGNED_BYTE,s);else if(n.width||n.height)o.texImage2D(f,0,A,n.width,n.height,n.border,A,o.UNSIGNED_BYTE,null);k||i.forEach(function(z){z.name=o.get(z.name);z.value=o.get(z.value);o.texParameteri(d,z.name,z.value);z.generateMipmap&&o.generateMipmap(d)});m.isCube=h;if(u)m.data.value=false;this.textureMemo[r]=
m;return this}},setTextures:function(r){for(var m in r)this.setTexture(m,r[m]);return this},use:function(r){o.useProgram(r.program);this.usedProgram=r;return this}};y.Application=x;(function(){try{var r=document.createElement("canvas");PhiloGL.hasWebGL=function(){return!!(window.WebGLRenderingContext&&(r.getContext("webgl")||r.getContext("experimental-webgl")))}}catch(m){PhiloGL.hasWebGL=function(){return false}}})();PhiloGL.WebGL=y})();(function(){function x(a){return{get:function(){return this[a]},
set:function(b){this[a]=b},configurable:false,enumerable:false}}var y=Math.sqrt,r=Math.sin,m=Math.cos,d=Math.tan,f=Math.PI,h=Array.prototype.slice,k=this.Float32Array,c=function(){if(!k||!k.call)return Array;try{k.call({},10)}catch(a){return Array}return k}(),l=c!=Array,i=function(a,b,g){if(l){k.call(this,3);this[0]=a||0;this[1]=b||0;this[2]=g||0}else this.push(a||0,b||0,g||0);this.typedContainer=new k(3)};i.create=function(){return new k(3)};i.prototype=Object.create(c.prototype,{$$family:{value:"Vec3"},
x:x(0),y:x(1),z:x(2)});var n={setVec3:function(a,b){a[0]=b[0];a[1]=b[1];a[2]=b[2];return a},set:function(a,b,g,j){a[0]=b;a[1]=g;a[2]=j;return a},add:function(a,b){return new i(a[0]+b[0],a[1]+b[1],a[2]+b[2])},$add:function(a,b){a[0]+=b[0];a[1]+=b[1];a[2]+=b[2];return a},add2:function(a,b,g){a[0]=b[0]+g[0];a[1]=b[1]+g[1];a[2]=b[2]+g[2];return a},sub:function(a,b){return new i(a[0]-b[0],a[1]-b[1],a[2]-b[2])},$sub:function(a,b){a[0]-=b[0];a[1]-=b[1];a[2]-=b[2];return a},sub2:function(a,b,g){a[0]=b[0]-
g[0];a[1]=b[1]-g[1];a[2]=b[2]-g[2];return a},scale:function(a,b){return new i(a[0]*b,a[1]*b,a[2]*b)},$scale:function(a,b){a[0]*=b;a[1]*=b;a[2]*=b;return a},neg:function(a){return new i(-a[0],-a[1],-a[2])},$neg:function(a){a[0]=-a[0];a[1]=-a[1];a[2]=-a[2];return a},unit:function(a){var b=i.norm(a);if(b>0)return i.scale(a,1/b);return i.clone(a)},$unit:function(a){var b=i.norm(a);if(b>0)return i.$scale(a,1/b);return a},cross:function(a,b){var g=a[0],j=a[1],p=a[2],q=b[0],v=b[1],w=b[2];return new i(j*
w-p*v,p*q-g*w,g*v-j*q)},$cross:function(a,b){var g=a[0],j=a[1],p=a[2],q=b[0],v=b[1],w=b[2];a[0]=j*w-p*v;a[1]=p*q-g*w;a[2]=g*v-j*q;return a},distTo:function(a,b){var g=a[0]-b[0],j=a[1]-b[1],p=a[2]-b[2];return y(g*g+j*j+p*p)},distToSq:function(a,b){var g=a[0]-b[0],j=a[1]-b[1],p=a[2]-b[2];return g*g+j*j+p*p},norm:function(a){var b=a[0],g=a[1];a=a[2];return y(b*b+g*g+a*a)},normSq:function(a){var b=a[0],g=a[1];a=a[2];return b*b+g*g+a*a},dot:function(a,b){return a[0]*b[0]+a[1]*b[1]+a[2]*b[2]},clone:function(a){return a.$$family?
new i(a[0],a[1],a[2]):i.setVec3(new k(3),a)},toFloat32Array:function(a){var b=a.typedContainer;if(!b)return a;b[0]=a[0];b[1]=a[1];b[2]=a[2];return b}},s=i.prototype,A;for(A in n){i[A]=n[A];s[A]=function(a){return function(){var b=h.call(arguments);b.unshift(this);return i[a].apply(i,b)}}(A)}var u=function(a,b,g,j,p,q,v,w,B,C,D,E,G,I,J,H){c.call(this,16);this.length=16;typeof a=="number"?this.set(a,b,g,j,p,q,v,w,B,C,D,E,G,I,J,H):this.id();this.typedContainer=new k(16)};u.create=function(){return new k(16)};
u.prototype=Object.create(c.prototype,{$$family:{value:"Mat4"},n11:x(0),n12:x(4),n13:x(8),n14:x(12),n21:x(1),n22:x(5),n23:x(9),n24:x(13),n31:x(2),n32:x(6),n33:x(10),n34:x(14),n41:x(3),n42:x(7),n43:x(11),n44:x(15)});n={id:function(a){a[0]=1;a[1]=0;a[2]=0;a[3]=0;a[4]=0;a[5]=1;a[6]=0;a[7]=0;a[8]=0;a[9]=0;a[10]=1;a[11]=0;a[12]=0;a[13]=0;a[14]=0;a[15]=1;return a},clone:function(a){return a.$$family?new u(a[0],a[4],a[8],a[12],a[1],a[5],a[9],a[13],a[2],a[6],a[10],a[14],a[3],a[7],a[11],a[15]):new k(a)},set:function(a,
b,g,j,p,q,v,w,B,C,D,E,G,I,J,H,F){a[0]=b;a[4]=g;a[8]=j;a[12]=p;a[1]=q;a[5]=v;a[9]=w;a[13]=B;a[2]=C;a[6]=D;a[10]=E;a[14]=G;a[3]=I;a[7]=J;a[11]=H;a[15]=F;return a},mulVec3:function(a,b){var g=i.clone(b);return u.$mulVec3(a,g)},$mulVec3:function(a,b){var g=b[0],j=b[1],p=b[2],q=1/(a[3]*g+a[7]*j+a[11]*p+a[15]);b[0]=(a[0]*g+a[4]*j+a[8]*p+a[12])*q;b[1]=(a[1]*g+a[5]*j+a[9]*p+a[13])*q;b[2]=(a[2]*g+a[6]*j+a[10]*p+a[14])*q;return b},mulMat42:function(a,b,g){var j=b[0],p=b[1],q=b[2],v=b[3],w=b[4],B=b[5],C=b[6],
D=b[7],E=b[8],G=b[9],I=b[10],J=b[11],H=b[12],F=b[13],N=b[14];b=b[15];var K=g[0],L=g[1],P=g[2],Q=g[3],R=g[4],U=g[5],V=g[6],W=g[7],S=g[8],T=g[9],X=g[10],O=g[11],Y=g[12],Z=g[13],$=g[14];g=g[15];a[0]=K*j+L*w+P*E+Q*H;a[1]=K*p+L*B+P*G+Q*F;a[2]=K*q+L*C+P*I+Q*N;a[3]=K*v+L*D+P*J+Q*b;a[4]=R*j+U*w+V*E+W*H;a[5]=R*p+U*B+V*G+W*F;a[6]=R*q+U*C+V*I+W*N;a[7]=R*v+U*D+V*J+W*b;a[8]=S*j+T*w+X*E+O*H;a[9]=S*p+T*B+X*G+O*F;a[10]=S*q+T*C+X*I+O*N;a[11]=S*v+T*D+X*J+O*b;a[12]=Y*j+Z*w+$*E+g*H;a[13]=Y*p+Z*B+$*G+g*F;a[14]=Y*q+Z*
=======
camera:{fov:45,near:0.1,far:500},program:{from:"defaults",vs:"Default",fs:"Default"},scene:{},textures:{src:[]},events:{},onLoad:t.empty,onError:t.empty},y||{});var l=y.context,d=y.camera,f=y.events,h=y.textures,j=t.splat(y.program),c=y.scene;o=PhiloGL.WebGL.getContext(x,l);if(!o){y.onError("The WebGL context couldn't been initialized");return null}var k={defaults:"fromDefaultShaders",ids:"fromShaderIds",sources:"fromShaderSources",uris:"fromShaderURIs"},i=j.length,n=function(){var s=i,A={},u=false;
return{onSuccess:function(z,a){A[a.id||i-s]=z;s--;if(s===0&&!u)r(o,i==1?z:A,function(b){y.onLoad(b)})},onError:function(z){s--;y.onError(z);u=true}}}();j.forEach(function(s){var A=s.from,u,z;for(z in k)if(A==z){try{u=PhiloGL.Program[k[z]](t.extend(n,s))}catch(a){n.onError(a)}break}if(u)n.onSuccess(u,s)})}})();PhiloGL.unpack=function(x){x=x||aa;["Vec3","Mat4","Quat","Camera","Program","WebGL","O3D","Scene","Shaders","IO","Events","WorkerGroup","Fx","Media"].forEach(function(y){x[y]=PhiloGL[y]})};PhiloGL.version=
"1.4.2";var o,M,aa=this;t.empty=function(){};t.time=Date.now;t.uid=function(){var x=t.time();return function(){return x++}}();t.extend=function(x,y){for(var r in y)x[r]=y[r];return x};t.type=function(){var x=Object.prototype.toString;return function(y){var r;r=x.call(y);r=r.substr(8,r.length-9).toLowerCase();if(r!="object")return r;if(y.$$family)return y.$$family;return y&&y.nodeName&&y.nodeType==1?"element":r}}();(function(){function x(y){var r=t.type(y);if(r=="object"){r={};for(var l in y)r[l]=
x(y[l]);return r}else if(r=="array"){r=[];l=0;for(var d=y.length;l<d;l++)r[l]=x(y[l]);return r}else return y}t.merge=function(){for(var y={},r=0,l=arguments.length;r<l;r++){var d=arguments[r];if(t.type(d)=="object")for(var f in d){var h=d[f],j=y[f];y[f]=j&&t.type(h)=="object"&&t.type(j)=="object"?t.merge(j,h):x(h)}}return y}})();t.splat=function(){var x=Array.isArray;return function(y){return x(y)&&y||[y]}}();(function(){function x(r){for(var l in r)this[l]=r[l];this.buffers={};this.bufferMemo={};
this.frameBuffers={};this.frameBufferMemo={};this.renderBuffers={};this.renderBufferMemo={};this.textures={};this.textureMemo={}}var y={getContext:function(r,l){r=typeof r=="string"?t(r):r;var d;(d=r.getContext("experimental-webgl",l))||(d=r.getContext("webgl",l));if(d&&l&&l.debug){o={};for(var f in d){var h=d[f];o[f]=typeof h=="function"?function(j,c){return function(){console.log(j,Array.prototype.join.call(arguments),Array.prototype.slice.call(arguments));try{var k=c.apply(d,arguments)}catch(i){throw j+
" "+i;}for(var n=[],s;(s=d.getError())!==d.NO_ERROR;)n.push(s);if(n.length)throw n.join();return k}}(f,h):h}}else o=d;if(o)o.get=function(j){return typeof j=="string"?o[j]:j};return o}};x.prototype={$$family:"application",setBuffer:function(r,l,d){if(d===false||d===null){(d=this.bufferMemo[l])&&o.bindBuffer(d.bufferType,null);var f=d&&d.attribute||l;r=r.attributes[f];r!==undefined&&o.disableVertexAttribArray(r)}else{d=t.extend(this.bufferMemo[l]||{bufferType:o.ARRAY_BUFFER,size:1,dataType:o.FLOAT,
stride:0,offset:0,drawType:o.STATIC_DRAW},d||{});f=d.attribute||l;var h=d.bufferType,j=l in this.buffers,c=j?this.buffers[l]:o.createBuffer(),k="value"in d,i=d.value,n=d.size,s=d.dataType,A=d.stride,u=d.offset,z=d.drawType;r=r.attributes[f];var a=r!==undefined;j||(this.buffers[l]=c);a&&o.enableVertexAttribArray(r);o.bindBuffer(h,c);k&&o.bufferData(h,i,z);a&&o.vertexAttribPointer(r,n,s,false,A,u);delete d.value;this.bufferMemo[l]=d;if(a)this.bufferMemo[f]=d;return this}},setBuffers:function(r,l){for(var d in l)this.setBuffer(r,
d,l[d]);return this},setFrameBuffer:function(r,l){if(typeof l!="object")o.bindFramebuffer(o.FRAMEBUFFER,l?this.frameBuffers[r]:null);else{l=t.merge(this.frameBufferMemo[r]||{width:0,height:0,bindToTexture:false,textureOptions:{attachment:o.COLOR_ATTACHMENT0},bindToRenderBuffer:false,renderBufferOptions:{attachment:o.DEPTH_ATTACHMENT}},l||{});var d=l.bindToTexture,f=l.bindToRenderBuffer,h=r in this.frameBuffers,j=h?this.frameBuffers[r]:o.createFramebuffer(o.FRAMEBUFFER);o.bindFramebuffer(o.FRAMEBUFFER,
j);h||(this.frameBuffers[r]=j);if(d){d=t.merge({data:{width:l.width,height:l.height}},t.type(d)=="object"?d:{});h=r+"-texture";j=l.textureOptions;this.setTexture(h,d);o.framebufferTexture2D(o.FRAMEBUFFER,j.attachment,this.textureMemo[h].textureType,this.textures[h],0)}if(f){f=t.extend({width:l.width,height:l.height},t.type(f)=="object"?f:{});d=r+"-renderbuffer";h=l.renderBufferOptions;this.setRenderBuffer(d,f);o.framebufferRenderbuffer(o.FRAMEBUFFER,h.attachment,o.RENDERBUFFER,this.renderBuffers[d])}o.bindTexture(o.TEXTURE_2D,
null);o.bindRenderbuffer(o.RENDERBUFFER,null);o.bindFramebuffer(o.FRAMEBUFFER,null);this.frameBufferMemo[r]=l;return this}},setFrameBuffers:function(r){for(var l in r)this.setFrameBuffer(l,r[l]);return this},setRenderBuffer:function(r,l){if(typeof l!="object")o.bindRenderbuffer(o.RENDERBUFFER,l?this.renderBufferMemo[r]:null);else{l=t.extend(this.renderBufferMemo[r]||{storageType:o.DEPTH_COMPONENT16,width:0,height:0},l||{});var d=r in this.renderBuffers,f=d?this.renderBuffers[r]:o.createRenderbuffer(o.RENDERBUFFER);
d||(this.renderBuffers[r]=f);o.bindRenderbuffer(o.RENDERBUFFER,f);o.renderbufferStorage(o.RENDERBUFFER,l.storageType,l.width,l.height);this.renderBufferMemo[r]=l;return this}},setRenderBuffers:function(r){for(var l in r)this.setRenderBuffer(l,r[l]);return this},setTexture:function(r,l){if(!l||typeof l!="object"){o.activeTexture(l||o.TEXTURE0);o.bindTexture(this.textureMemo[r].textureType||o.TEXTURE_2D,this.textures[r])}else{l=t.merge(this.textureMemo[r]||{textureType:o.TEXTURE_2D,pixelStore:[{name:o.UNPACK_FLIP_Y_WEBGL,
value:true},{name:o.UNPACK_ALIGNMENT,value:1}],parameters:[{name:o.TEXTURE_MAG_FILTER,value:o.NEAREST},{name:o.TEXTURE_MIN_FILTER,value:o.NEAREST}],data:{format:o.RGBA,value:false,width:0,height:0,border:0}},l||{});var d="textureType"in l?o.get(l.textureType):o.TEXTURE_2D,f="textureTarget"in l?o.get(l.textureTarget):d,h=d==o.TEXTURE_CUBE_MAP,j=r in this.textures,c=j?this.textures[r]:o.createTexture(),k=l.pixelStore,i=l.parameters,n=l.data,s=n.value,A=n.format,u=!!n.value;j||(this.textures[r]=c);o.bindTexture(d,
c);j||k.forEach(function(z){z.name=typeof z.name=="string"?o[z.name]:z.name;o.pixelStorei(z.name,z.value)});if(u)if(h)for(c=0;c<6;++c)o.texImage2D(f[c],0,A,A,o.UNSIGNED_BYTE,s[c]);else o.texImage2D(f,0,A,A,o.UNSIGNED_BYTE,s);else if(n.width||n.height)o.texImage2D(f,0,A,n.width,n.height,n.border,A,o.UNSIGNED_BYTE,null);j||i.forEach(function(z){z.name=o.get(z.name);z.value=o.get(z.value);o.texParameteri(d,z.name,z.value);z.generateMipmap&&o.generateMipmap(d)});l.isCube=h;l.data.value=false;this.textureMemo[r]=
l;return this}},setTextures:function(r){for(var l in r)this.setTexture(l,r[l]);return this},use:function(r){o.useProgram(r.program);this.usedProgram=r;return this}};y.Application=x;(function(){try{var r=document.createElement("canvas");PhiloGL.hasWebGL=function(){return!!(window.WebGLRenderingContext&&(r.getContext("webgl")||r.getContext("experimental-webgl")))}}catch(l){PhiloGL.hasWebGL=function(){return false}}})();PhiloGL.WebGL=y})();(function(){function x(a){return{get:function(){return this[a]},
set:function(b){this[a]=b},configurable:false,enumerable:false}}var y=Math.sqrt,r=Math.sin,l=Math.cos,d=Math.tan,f=Math.PI,h=Array.prototype.slice,j=this.Float32Array,c=function(){if(!j||!j.call)return Array;try{j.call({},10)}catch(a){return Array}return j}(),k=c!=Array,i=function(a,b,g){if(k){j.call(this,3);this[0]=a||0;this[1]=b||0;this[2]=g||0}else this.push(a||0,b||0,g||0);this.typedContainer=new j(3)};i.create=function(){return new j(3)};i.prototype=Object.create(c.prototype,{$$family:{value:"Vec3"},
x:x(0),y:x(1),z:x(2)});var n={setVec3:function(a,b){a[0]=b[0];a[1]=b[1];a[2]=b[2];return a},set:function(a,b,g,m){a[0]=b;a[1]=g;a[2]=m;return a},add:function(a,b){return new i(a[0]+b[0],a[1]+b[1],a[2]+b[2])},$add:function(a,b){a[0]+=b[0];a[1]+=b[1];a[2]+=b[2];return a},add2:function(a,b,g){a[0]=b[0]+g[0];a[1]=b[1]+g[1];a[2]=b[2]+g[2];return a},sub:function(a,b){return new i(a[0]-b[0],a[1]-b[1],a[2]-b[2])},$sub:function(a,b){a[0]-=b[0];a[1]-=b[1];a[2]-=b[2];return a},sub2:function(a,b,g){a[0]=b[0]-
g[0];a[1]=b[1]-g[1];a[2]=b[2]-g[2];return a},scale:function(a,b){return new i(a[0]*b,a[1]*b,a[2]*b)},$scale:function(a,b){a[0]*=b;a[1]*=b;a[2]*=b;return a},neg:function(a){return new i(-a[0],-a[1],-a[2])},$neg:function(a){a[0]=-a[0];a[1]=-a[1];a[2]=-a[2];return a},unit:function(a){var b=i.norm(a);if(b>0)return i.scale(a,1/b);return i.clone(a)},$unit:function(a){var b=i.norm(a);if(b>0)return i.$scale(a,1/b);return a},cross:function(a,b){var g=a[0],m=a[1],p=a[2],q=b[0],v=b[1],w=b[2];return new i(m*
w-p*v,p*q-g*w,g*v-m*q)},$cross:function(a,b){var g=a[0],m=a[1],p=a[2],q=b[0],v=b[1],w=b[2];a[0]=m*w-p*v;a[1]=p*q-g*w;a[2]=g*v-m*q;return a},distTo:function(a,b){var g=a[0]-b[0],m=a[1]-b[1],p=a[2]-b[2];return y(g*g+m*m+p*p)},distToSq:function(a,b){var g=a[0]-b[0],m=a[1]-b[1],p=a[2]-b[2];return g*g+m*m+p*p},norm:function(a){var b=a[0],g=a[1];a=a[2];return y(b*b+g*g+a*a)},normSq:function(a){var b=a[0],g=a[1];a=a[2];return b*b+g*g+a*a},dot:function(a,b){return a[0]*b[0]+a[1]*b[1]+a[2]*b[2]},clone:function(a){return a.$$family?
new i(a[0],a[1],a[2]):i.setVec3(new j(3),a)},toFloat32Array:function(a){var b=a.typedContainer;if(!b)return a;b[0]=a[0];b[1]=a[1];b[2]=a[2];return b}},s=i.prototype,A;for(A in n){i[A]=n[A];s[A]=function(a){return function(){var b=h.call(arguments);b.unshift(this);return i[a].apply(i,b)}}(A)}var u=function(a,b,g,m,p,q,v,w,B,C,D,E,G,I,J,H){c.call(this,16);this.length=16;typeof a=="number"?this.set(a,b,g,m,p,q,v,w,B,C,D,E,G,I,J,H):this.id();this.typedContainer=new j(16)};u.create=function(){return new j(16)};
u.prototype=Object.create(c.prototype,{$$family:{value:"Mat4"},n11:x(0),n12:x(4),n13:x(8),n14:x(12),n21:x(1),n22:x(5),n23:x(9),n24:x(13),n31:x(2),n32:x(6),n33:x(10),n34:x(14),n41:x(3),n42:x(7),n43:x(11),n44:x(15)});n={id:function(a){a[0]=1;a[1]=0;a[2]=0;a[3]=0;a[4]=0;a[5]=1;a[6]=0;a[7]=0;a[8]=0;a[9]=0;a[10]=1;a[11]=0;a[12]=0;a[13]=0;a[14]=0;a[15]=1;return a},clone:function(a){return a.$$family?new u(a[0],a[4],a[8],a[12],a[1],a[5],a[9],a[13],a[2],a[6],a[10],a[14],a[3],a[7],a[11],a[15]):new j(a)},set:function(a,
b,g,m,p,q,v,w,B,C,D,E,G,I,J,H,F){a[0]=b;a[4]=g;a[8]=m;a[12]=p;a[1]=q;a[5]=v;a[9]=w;a[13]=B;a[2]=C;a[6]=D;a[10]=E;a[14]=G;a[3]=I;a[7]=J;a[11]=H;a[15]=F;return a},mulVec3:function(a,b){var g=i.clone(b);return u.$mulVec3(a,g)},$mulVec3:function(a,b){var g=b[0],m=b[1],p=b[2],q=1/(a[3]*g+a[7]*m+a[11]*p+a[15]);b[0]=(a[0]*g+a[4]*m+a[8]*p+a[12])*q;b[1]=(a[1]*g+a[5]*m+a[9]*p+a[13])*q;b[2]=(a[2]*g+a[6]*m+a[10]*p+a[14])*q;return b},mulMat42:function(a,b,g){var m=b[0],p=b[1],q=b[2],v=b[3],w=b[4],B=b[5],C=b[6],
D=b[7],E=b[8],G=b[9],I=b[10],J=b[11],H=b[12],F=b[13],N=b[14];b=b[15];var K=g[0],L=g[1],P=g[2],Q=g[3],R=g[4],U=g[5],V=g[6],W=g[7],S=g[8],T=g[9],X=g[10],O=g[11],Y=g[12],Z=g[13],$=g[14];g=g[15];a[0]=K*m+L*w+P*E+Q*H;a[1]=K*p+L*B+P*G+Q*F;a[2]=K*q+L*C+P*I+Q*N;a[3]=K*v+L*D+P*J+Q*b;a[4]=R*m+U*w+V*E+W*H;a[5]=R*p+U*B+V*G+W*F;a[6]=R*q+U*C+V*I+W*N;a[7]=R*v+U*D+V*J+W*b;a[8]=S*m+T*w+X*E+O*H;a[9]=S*p+T*B+X*G+O*F;a[10]=S*q+T*C+X*I+O*N;a[11]=S*v+T*D+X*J+O*b;a[12]=Y*m+Z*w+$*E+g*H;a[13]=Y*p+Z*B+$*G+g*F;a[14]=Y*q+Z*
>>>>>>> stuff
C+$*I+g*N;a[15]=Y*v+Z*D+$*J+g*b;return a},mulMat4:function(a,b){var g=u.clone(a);return u.mulMat42(g,a,b)},$mulMat4:function(a,b){return u.mulMat42(a,a,b)},add:function(a,b){var g=u.clone(a);return u.$add(g,b)},$add:function(a,b){a[0]+=b[0];a[1]+=b[1];a[2]+=b[2];a[3]+=b[3];a[4]+=b[4];a[5]+=b[5];a[6]+=b[6];a[7]+=b[7];a[8]+=b[8];a[9]+=b[9];a[10]+=b[10];a[11]+=b[11];a[12]+=b[12];a[13]+=b[13];a[14]+=b[14];a[15]+=b[15];return a},transpose:function(a){a=u.clone(a);return u.$transpose(a)},$transpose:function(a){var b=
a[8],g=a[12],j=a[1],p=a[9],q=a[13],v=a[2],w=a[6],B=a[14],C=a[3],D=a[7],E=a[11];a[1]=a[4];a[2]=b;a[3]=g;a[4]=j;a[6]=p;a[7]=q;a[8]=v;a[9]=w;a[11]=B;a[12]=C;a[13]=D;a[14]=E;return a},rotateAxis:function(a,b,g){a=u.clone(a);return u.$rotateAxis(a,b,g)},$rotateAxis:function(a,b,g){var j=r(b),p=m(b),q=1-p,v=g[0],w=g[1],B=g[2];g=v*v*q+p;b=v*w*q+B*j;var C=v*B*q-w*j,D=w*v*q-B*j,E=w*w*q+p,G=w*B*q+v*j,I=v*B*q+w*j;j=w*B*q-v*j;p=B*B*q+p;q=a[0];v=a[1];w=a[2];B=a[3];var J=a[4],H=a[5],F=a[6],N=a[7],K=a[8],L=a[9],
P=a[10],Q=a[11];a[0]=q*g+J*b+K*C;a[1]=v*g+H*b+L*C;a[2]=w*g+F*b+P*C;a[3]=B*g+N*b+Q*C;a[4]=q*D+J*E+K*G;a[5]=v*D+H*E+L*G;a[6]=w*D+F*E+P*G;a[7]=B*D+N*E+Q*G;a[8]=q*I+J*j+K*p;a[9]=v*I+H*j+L*p;a[10]=w*I+F*j+P*p;a[11]=B*I+N*j+Q*p;return a},rotateXYZ:function(a,b,g,j){a=u.clone(a);return u.$rotateXYZ(a,b,g,j)},$rotateXYZ:function(a,b,g,j){var p=a[0],q=a[1],v=a[2],w=a[3],B=a[4],C=a[5],D=a[6],E=a[7],G=a[8],I=a[9],J=a[10],H=a[11],F=m(b),N=m(g),K=m(j);b=r(b);var L=r(g),P=r(j);j=N*K;g=-F*P+b*L*K;var Q=b*P+F*L*
K,R=N*P,U=F*K+b*L*P;K=-b*K+F*L*P;L=-L;b*=N;F*=N;a[0]=p*j+B*R+G*L;a[1]=q*j+C*R+I*L;a[2]=v*j+D*R+J*L;a[3]=w*j+E*R+H*L;a[4]=p*g+B*U+G*b;a[5]=q*g+C*U+I*b;a[6]=v*g+D*U+J*b;a[7]=w*g+E*U+H*b;a[8]=p*Q+B*K+G*F;a[9]=q*Q+C*K+I*F;a[10]=v*Q+D*K+J*F;a[11]=w*Q+E*K+H*F;return a},translate:function(a,b,g,j){a=u.clone(a);return u.$translate(a,b,g,j)},$translate:function(a,b,g,j){a[12]=a[0]*b+a[4]*g+a[8]*j+a[12];a[13]=a[1]*b+a[5]*g+a[9]*j+a[13];a[14]=a[2]*b+a[6]*g+a[10]*j+a[14];a[15]=a[3]*b+a[7]*g+a[11]*j+a[15];return a},
scale:function(a,b,g,j){a=u.clone(a);return u.$scale(a,b,g,j)},$scale:function(a,b,g,j){a[0]*=b;a[1]*=b;a[2]*=b;a[3]*=b;a[4]*=g;a[5]*=g;a[6]*=g;a[7]*=g;a[8]*=j;a[9]*=j;a[10]*=j;a[11]*=j;return a},invert:function(a){a=u.clone(a);return u.$invert(a)},$invert:function(a){var b=a[0],g=a[1],j=a[2],p=a[3],q=a[4],v=a[5],w=a[6],B=a[7],C=a[8],D=a[9],E=a[10],G=a[11],I=a[12],J=a[13],H=a[14],F=a[15],N=b*v-g*q,K=b*w-j*q,L=b*B-p*q,P=g*w-j*v,Q=g*B-p*v,R=j*B-p*w,U=C*J-D*I,V=C*H-E*I,W=C*F-G*I,S=D*H-E*J,T=D*F-G*J,
X=E*F-G*H,O=1/(N*X-K*T+L*S+P*W-Q*V+R*U);a[0]=(+v*X-w*T+B*S)*O;a[1]=(-g*X+j*T-p*S)*O;a[2]=(+J*R-H*Q+F*P)*O;a[3]=(-D*R+E*Q-G*P)*O;a[4]=(-q*X+w*W-B*V)*O;a[5]=(+b*X-j*W+p*V)*O;a[6]=(-I*R+H*L-F*K)*O;a[7]=(+C*R-E*L+G*K)*O;a[8]=(+q*T-v*W+B*U)*O;a[9]=(-b*T+g*W-p*U)*O;a[10]=(+I*Q-J*L+F*N)*O;a[11]=(-C*Q+D*L-G*N)*O;a[12]=(-q*S+v*V-w*U)*O;a[13]=(+b*S-g*V+j*U)*O;a[14]=(-I*P+J*K-H*N)*O;a[15]=(+C*P-D*K+E*N)*O;return a},lookAt:function(a,b,g,j){g=i.sub(b,g);g.$unit();j=i.cross(j,g);j.$unit();var p=i.cross(g,j);p.$unit();
return u.set(a,j[0],j[1],j[2],-j.dot(b),p[0],p[1],p[2],-p.dot(b),g[0],g[1],g[2],-g.dot(b),0,0,0,1)},frustum:function(a,b,g,j,p,q,v){var w=g-b,B=p-j,C=v-q;a[0]=q*2/w;a[1]=0;a[2]=0;a[3]=0;a[4]=0;a[5]=q*2/B;a[6]=0;a[7]=0;a[8]=(g+b)/w;a[9]=(p+j)/B;a[10]=-(v+q)/C;a[11]=-1;a[12]=0;a[13]=0;a[14]=-(v*q*2)/C;a[15]=0;return a},perspective:function(a,b,g,j,p){b=j*d(b*f/360);var q=-b;return u.frustum(a,q*g,b*g,q,b,j,p)},ortho:function(a,b,g,j,p,q,v){var w=g-b,B=p-j,C=v-q;a[0]=2/w;a[1]=0;a[2]=0;a[3]=0;a[4]=0;
a[5]=2/B;a[6]=0;a[7]=0;a[8]=0;a[9]=0;a[10]=-2/C;a[11]=0;a[12]=-(b+g)/w;a[13]=-(p+j)/B;a[14]=-(v+q)/C;a[15]=1;return a},toFloat32Array:function(a){var b=a.typedContainer;if(!b)return a;b[0]=a[0];b[1]=a[1];b[2]=a[2];b[3]=a[3];b[4]=a[4];b[5]=a[5];b[6]=a[6];b[7]=a[7];b[8]=a[8];b[9]=a[9];b[10]=a[10];b[11]=a[11];b[12]=a[12];b[13]=a[13];b[14]=a[14];b[15]=a[15];return b}};s=u.prototype;for(A in n){u[A]=n[A];s[A]=function(a){return function(){var b=h.call(arguments);b.unshift(this);return u[a].apply(u,b)}}(A)}var z=
function(a,b,g,j){c.call(this,4);this[0]=a||0;this[1]=b||0;this[2]=g||0;this[3]=j||0;this.typedContainer=new k(4)};z.create=function(){return new k(4)};n={setQuat:function(a,b){a[0]=b[0];a[1]=b[1];a[2]=b[2];a[3]=b[3];return a},set:function(a,b,g,j,p){a[0]=b||0;a[1]=g||0;a[2]=j||0;a[3]=p||0;return a},clone:function(a){return a.$$family?new z(a[0],a[1],a[2],a[3]):z.setQuat(new k(4),a)},neg:function(a){return new z(-a[0],-a[1],-a[2],-a[3])},$neg:function(a){a[0]=-a[0];a[1]=-a[1];a[2]=-a[2];a[3]=-a[3];
return a},add:function(a,b){return new z(a[0]+b[0],a[1]+b[1],a[2]+b[2],a[3]+b[3])},$add:function(a,b){a[0]+=b[0];a[1]+=b[1];a[2]+=b[2];a[3]+=b[3];return a},sub:function(a,b){return new z(a[0]-b[0],a[1]-b[1],a[2]-b[2],a[3]-b[3])},$sub:function(a,b){a[0]-=b[0];a[1]-=b[1];a[2]-=b[2];a[3]-=b[3];return a},scale:function(a,b){return new z(a[0]*b,a[1]*b,a[2]*b,a[3]*b)},$scale:function(a,b){a[0]*=b;a[1]*=b;a[2]*=b;a[3]*=b;return a},mulQuat:function(a,b){var g=a[0],j=a[1],p=a[2],q=a[3],v=b[0],w=b[1],B=b[2],
C=b[3];return new z(q*v+g*C+j*B-p*w,q*w+j*C+p*v-g*B,q*B+p*C+g*w-j*v,q*C-g*v-j*w-p*B)},$mulQuat:function(a,b){var g=a[0],j=a[1],p=a[2],q=a[3],v=b[0],w=b[1],B=b[2],C=b[3];a[0]=q*v+g*C+j*B-p*w;a[1]=q*w+j*C+p*v-g*B;a[2]=q*B+p*C+g*w-j*v;a[3]=q*C-g*v-j*w-p*B;return a},divQuat:function(a,b){var g=a[0],j=a[1],p=a[2],q=a[3],v=b[0],w=b[1],B=b[2],C=b[3],D=1/(C*C+v*v+w*w+B*B);return new z((g*C-q*v-j*B+p*w)*D,(g*B-q*w+j*C-p*v)*D,(j*v+p*C-q*B-g*w)*D,(q*C+g*v+j*w+p*B)*D)},$divQuat:function(a,b){var g=a[0],j=a[1],
p=a[2],q=a[3],v=b[0],w=b[1],B=b[2],C=b[3],D=1/(C*C+v*v+w*w+B*B);a[0]=(g*C-q*v-j*B+p*w)*D;a[1]=(g*B-q*w+j*C-p*v)*D;a[2]=(j*v+p*C-q*B-g*w)*D;a[3]=(q*C+g*v+j*w+p*B)*D;return a},invert:function(a){var b=a[0],g=a[1],j=a[2];a=a[3];var p=1/(b*b+g*g+j*j+a*a);return new z(-b*p,-g*p,-j*p,a*p)},$invert:function(a){var b=a[0],g=a[1],j=a[2],p=a[3],q=1/(b*b+g*g+j*j+p*p);a[0]=-b*q;a[1]=-g*q;a[2]=-j*q;a[3]=p*q;return a},norm:function(a){var b=a[0],g=a[1],j=a[2];a=a[3];return y(b*b+g*g+j*j+a*a)},normSq:function(a){var b=
a[0],g=a[1],j=a[2];a=a[3];return b*b+g*g+j*j+a*a},unit:function(a){return z.scale(a,1/z.norm(a))},$unit:function(a){return z.$scale(a,1/z.norm(a))},conjugate:function(a){return new z(-a[0],-a[1],-a[2],a[3])},$conjugate:function(a){a[0]=-a[0];a[1]=-a[1];a[2]=-a[2];return a}};s=z.prototype={};for(A in n){z[A]=n[A];s[A]=function(a){return function(){var b=h.call(arguments);b.unshift(this);return z[a].apply(z,b)}}(A)}i.fromQuat=function(a){return new i(a[0],a[1],a[2])};z.fromVec3=function(a,b){return new z(a[0],
a[1],a[2],b||0)};z.fromMat4=function(a){var b,g,j;if(a[0]>a[5]&&a[0]>a[10]){b=0;g=1;j=2}else if(a[5]>a[0]&&a[5]>a[10]){b=1;g=2;j=0}else{b=2;g=0;j=1}var p=y(1+a[b*5]-a[g*5]-a[j*5]),q=new z;q[b]=0.5*p;q[g]=0.5*(a["n"+g+""+b]+a["n"+b+""+g])/p;q[j]=0.5*(a["n"+b+""+j]+a["n"+j+""+b])/p;q[3]=0.5*(a["n"+g+""+j]-a["n"+j+""+g])/p;return q};z.fromXRotation=function(a){return new z(r(a/2),0,0,m(a/2))};z.fromYRotation=function(a){return new z(0,r(a/2),0,m(a/2))};z.fromZRotation=function(a){return new z(0,0,r(a/
2),m(a/2))};z.fromAxisRotation=function(a,b){var g=a[0],j=a[1],p=a[2],q=1/y(g*g+j*j+p*p),v=r(b/2),w=m(b/2);return new z(v*g*q,v*j*q,v*p*q,w)};u.fromQuat=function(a){var b=a[3],g=a[0],j=a[1];a=a[2];return new u(b*b+g*g-j*j-a*a,2*g*j-2*b*a,2*g*a+2*b*j,0,2*g*j+2*b*a,b*b-g*g+j*j-a*a,2*j*a-2*b*g,0,2*g*a-2*b*j,2*j*a+2*b*g,b*b-g*g-j*j+a*a,0,0,0,0,1)};PhiloGL.Vec3=i;PhiloGL.Mat4=u;PhiloGL.Quat=z})();(function(){function x(f){return f!==true?f:false}var y=function(f){f=f.getBoundingClientRect();return{x:f.left,
y:f.top,bbox:f}},r={get:function(f,h){return f||(h||window).event},getWheel:function(f){return f.wheelDelta?f.wheelDelta/120:-(f.detail||0)/3},getKey:function(f){var h=f.which||f.keyCode,k;a:{k=d.Keys;for(var c in k)if(k[c]==h){k=c;break a}k=void 0}c=h-111;if(c>0&&c<13)k="f"+c;k=k||String.fromCharCode(h).toLowerCase();return{code:h,key:k,shift:f.shiftKey,control:f.ctrlKey,alt:f.altKey,meta:f.metaKey}},isRightClick:function(f){return f.which==3||f.button==2},getPos:function(f,h){h=h||window;f=f||h.event;
var k=h.document;k=k.documentElement||k.body;if(f.touches&&f.touches.length)f=f.touches[0];return{x:f.pageX||f.clientX+k.scrollLeft,y:f.pageY||f.clientY+k.scrollTop}},stop:function(f){f.stopPropagation&&f.stopPropagation();f.cancelBubble=true;if(f.preventDefault)f.preventDefault();else f.returnValue=false}},m=function(f,h){var k=f.canvas;this.scene=f.scene;this.domElem=k;this.pos=y(k);this.opt=this.callbacks=h;this.size={width:k.width||k.offsetWidth,height:k.height||k.offsetHeight};this.attachEvents()};
m.prototype={hovered:false,pressed:false,touched:false,touchMoved:false,moved:false,attachEvents:function(){var f=this.domElem,h=this;if(this.opt.disableContextMenu)f.oncontextmenu=function(){return false};["mouseup","mousedown","mousemove","mouseover","mouseout","touchstart","touchmove","touchend"].forEach(function(c){f.addEventListener(c,function(l,i){h[c](h.eventInfo(c,l,i))},false)});["keydown","keyup"].forEach(function(c){document.addEventListener(c,function(l,i){h[c](h.eventInfo(c,l,i))},false)});
var k="";k=!document.getBoxObjectFor&&window.mozInnerScreenX==null?"mousewheel":"DOMMouseScroll";f.addEventListener(k,function(c,l){h.mousewheel(h.eventInfo("mousewheel",c,l))},false)},eventInfo:function(f,h,k){var c=this.domElem,l=this.scene,i=this.opt,n=this.getSize(),s=i.relative,A=i.centerOrigin,u=i.cachePosition&&this.pos||y(c),z=r.get(h,k),a=r.getPos(h,k);h={};k=a.x;c=a.y;if(s){k-=u.x;c-=u.y;if(A){k-=n.width/2;c-=n.height/2;c*=-1}}switch(f){case "mousewheel":h.wheel=r.getWheel(z);break;case "keydown":case "keyup":t.extend(h,
r.getKey(z));break;case "mouseup":h.isRightClick=r.isRightClick(z)}var b;t.extend(h,{x:k,y:c,cache:false,stop:function(){r.stop(z)},getTarget:function(){if(b)return b;return b=!i.picking||l.pick(a.x-u.x,a.y-u.y,i.lazyPicking)||true}});h.event=z;return h},getSize:function(){if(this.cacheSize)return this.size;var f=this.domElem;return{width:f.width||f.offsetWidth,height:f.height||f.offsetHeight}},mouseup:function(f){if(!this.moved)if(f.isRightClick)this.callbacks.onRightClick(f,this.hovered);else this.callbacks.onClick(f,
x(this.pressed));if(this.pressed){if(this.moved)this.callbacks.onDragEnd(f,x(this.pressed));else this.callbacks.onDragCancel(f,x(this.pressed));this.pressed=this.moved=false}},mouseout:function(f){for(var h=f.relatedTarget,k=this.domElem;h&&h.parentNode;){if(k==h.parentNode)return;h=h.parentNode}if(this.hovered){this.callbacks.onMouseLeave(f,this.hovered);this.hovered=false}if(this.pressed&&this.moved){this.callbacks.onDragEnd(f);this.pressed=this.moved=false}},mouseover:function(){},mousemove:function(f){if(this.pressed){this.moved=
